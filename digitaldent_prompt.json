{
"model": "gemini-1.5-pro",
"prompt": "Actúa como arquitecto full-stack senior. Genera una app de producción para la empresa DigitalDent.\n\nNOMBRE DEL PROYECTO: digitaldent\nBRANDING: usa la paleta principal #214d66 como color primario y tonos claros complementarios para UI.\n\nOBJETIVO: Crear una plataforma web con frontend en Astro (Astro Build) que incluya: (1) landing page con formulario de contacto/captación, (2) app autenticada para usuarios (odontólogos, laboratorios, admins) con calendario, (3) conexión y notificaciones en tiempo real del estado de cada trabajo, (4) alertas configurables con días de anticipación para entrega, (5) módulo para subir escaneos intraorales (STL/PLY/OBJ, imágenes), (6) generación/visualización de modelos 3D en el navegador, (7) creación y gestión de órdenes de trabajo por caso, (8) cuenta corriente/estado de cuenta por cliente con facturación por trabajo, (9) una tienda de insumos dentales con carrito, checkout e inventario.\n\nSTACK Y ARQUITECTURA:\n- Frontend: Astro Build + Islands; UI con TailwindCSS; componentes accesibles; dark/light mode. Reutiliza componentes en /src/components. Router de Astro + endpoints API.\n- Autenticación y RBAC: email/password + OAuth (Google). Roles: admin, odontologo, laboratorio, cliente. Middleware para proteger rutas y permisos de lectura/escritura por rol.\n- Backend/API: Node.js (Astro API routes o subapp Express) con controladores REST/JSON. Considera separar /api para servicios (jobs, orders, files, billing, notifications, store).\n- Realtime: WebSockets o Supabase Realtime (o Firebase). Usa canales por workOrderId para emitir cambios de estado, y un canal global para notificaciones.\n- Base de datos: Supabase (Postgres). Migraciones incluidas. Índices en tablas de Jobs, Orders, Users, Payments, Inventory.\n- Archivos: almacenamiento S3-compatible para escaneos y fotos (carpetas por cliente/caso). Genera URLs firmadas para subida/descarga.\n- 3D: visor WebGL (three.js) para previsualizar STL/PLY/OBJ, con controles de orbitar, zoom, secciones, medición básica y captura de imagen.\n- Notificaciones: email (SMTP), y opcional push web (Service Workers) y WhatsApp/SMS vía proveedor (Twilio u otro). Sistema de plantillas por evento.\n- Tareas programadas: cron/queue (BullMQ + Redis) para alertas X días antes de la entrega y recordatorios.\n- Tienda: catálogo, categorías, stock, variantes, carrito, checkout, cupones. Pagos con proveedor localizable (Stripe por defecto). Webhooks para confirmar pagos y actualizar estados/stock.\n- Observabilidad: logs estructurados, manejo de errores, métricas básicas (tiempos, errores, colas). Env vars con .env.example.\n\nMODELO DE DATOS (Postgres):\nUser(id, name, email, role, clinicName, phone)\nPatient(id, name, birthdate, notes, ownerUserId)\nWorkOrder(id, code, status [NEW, IN_DESIGN, MILLING, FINISHING, SHIPPED, DELIVERED], dentistId, labId, patientId, dueDate, createdAt, updatedAt)\nWorkOrderEvent(id, workOrderId, type, message, createdAt)\nWorkOrderFile(id, workOrderId, kind [INTRAORAL_SCAN, PHOTO, DESIGN, BILL], url, size, mime)\nAppointment(id, dentistId, title, start, end, location, notes)\nInvoice(id, clientId, workOrderId, amount, currency, status [PENDING, PAID, PARTIAL], issuedAt, dueAt)\nAccountEntry(id, clientId, invoiceId, debit, credit, balanceAfter, createdAt)\nProduct(id, sku, name, description, category, price, currency, stock, images[])\nCart(id, userId, total)\nCartItem(id, cartId, productId, qty, unitPrice)\nPayment(id, invoiceId, provider, providerRef, amount, status, createdAt)\nNotification(id, userId, channel, title, body, read, createdAt)\n\nPÁGINAS/SECCIONES:\n- /  (Landing Astro): hero, beneficios, flujo de trabajo, testimonios, logos; formulario de contacto que guarda Lead y envía email.\n- /app (layout autenticado)\n  - /app/dashboard: resumen de órdenes activas, próximas entregas, notificaciones.\n  - /app/calendar: vista mensual/semanal para odontólogos (crear/editar citas). Arrastrar/soltar, recordatorios.\n  - /app/work-orders: listado, filtros, creación de nueva orden; vista detalle con timeline de eventos, chat interno, subida de archivos (drag&drop) y visor 3D.\n  - /app/patients: CRUD básico de pacientes y registros.\n  - /app/billing: facturas, pagos, estados de cuenta por cliente; exportar PDF/CSV.\n  - /app/store: catálogo, producto, carrito y checkout.\n  - /app/settings: perfil, clínica, roles, notificaciones, integraciones.\n\nFLUJOS CLAVE:\n1) Crear Orden: odontólogo completa formulario (paciente, descripción, fecha entrega, adjunta escaneos). Se crea WorkOrder con código legible (e.g., DD-2025-0001), se notifica al laboratorio y se abre canal realtime.\n2) Cambios de Estado: el laboratorio actualiza status; se agrega WorkOrderEvent, se emiten notificaciones realtime y por email/push según preferencia del usuario.\n3) Alertas: un job programado envía recordatorios N días antes de dueDate al odontólogo y al laboratorio.\n4) Escaneos y 3D: subida validada por tipo/tamaño; render con three.js; opción de snapshot PNG y anotaciones básicas.\n5) Facturación y Cuenta Corriente: por cada orden se genera factura o presupuesto; pagos actualizan AccountEntry y balance; reportes descargables.\n6) Tienda: navegación, búsqueda, carrito persistente, checkout con Stripe; stock decrece al confirmar pago vía webhook.\n\nREQUISITOS DE CÓDIGO A ENTREGAR:\n- Proyecto Astro listo para `npm run dev` y `npm run build`.\n- Estructura /src organizada; componentes reutilizables; páginas y endpoints API.\n- Schema SQL y seed básico.\n- Config Redis (si BullMQ) y ejemplo de cola para alertas.\n- Servicios: auth, files, billing, notifications, realtime.\n- Visor 3D en /src/components/ModelViewer.astro (three.js) con carga de STL/PLY/OBJ.\n- Formularios con validación (zod) y estados accesibles.\n- Pruebas unitarias básicas para servicios críticos.\n- Dockerfile y docker-compose opcional (db + redis).\n- README con pasos de instalación, variables de entorno y comandos.\n\nCOMANDOS ESPERADOS (ejemplos en README):\n- npm create astro@latest (plantilla) + integración Tailwind.\n- supabase db push\n- npm run dev\n\nACEPTACIÓN:\n- El proyecto compila y corre localmente.\n- CRUDs funcionales, auth por rol, realtime visible en detalle de WorkOrder.\n- Subidas de archivos y previsualización 3D operativas.\n- Alertas programadas funcionando (simulable con seed/cron rápido).\n- Checkout de tienda en modo test completando pago y actualizando stock.\n\nEntrega todo el código fuente, estructura de carpetas, archivos de configuración y ejemplos de .env. Usa comentarios claros y nombres semánticos.",
"variables": {
"PROJECT_NAME": "digitaldent",
"PRIMARY_COLOR": "#214d66",
"DEFAULT_ALERT_DAYS": 2
},
"deliverables_expected": [
"Proyecto Astro completo con API y Supabase",
"Esquema de base de datos y migraciones",
"Componentes UI y páginas descritas",
"Visor 3D three.js para STL/PLY/OBJ",
"Cola de trabajos para alertas programadas",
"Implementación realtime (WebSocket/Supabase/Firebase)",
"Módulo de tienda con checkout y webhooks",
"README con pasos de instalación y .env.example"
]
}
